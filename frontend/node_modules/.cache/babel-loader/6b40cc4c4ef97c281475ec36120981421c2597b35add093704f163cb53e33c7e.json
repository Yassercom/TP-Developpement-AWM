{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import axios from'axios';import jwt_decode from'jwt-decode';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(localStorage.getItem('token'));const[isAuthenticated,setIsAuthenticated]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Set axios default headers\nif(token){axios.defaults.headers.common['x-auth-token']=token;}else{delete axios.defaults.headers.common['x-auth-token'];}// Load user if token exists\nuseEffect(()=>{const loadUser=async()=>{if(token){try{const res=await axios.get('http://localhost:5001/api/auth/me');setUser(res.data);setIsAuthenticated(true);}catch(err){localStorage.removeItem('token');setToken(null);setUser(null);setIsAuthenticated(false);setError('Authentication error. Please login again.');}}setLoading(false);};loadUser();},[token]);// Register user\nconst register=async formData=>{try{console.log('Sending registration request with data:',formData);const res=await axios.post('http://localhost:5001/api/auth/register',formData);console.log('Registration response:',res.data);localStorage.setItem('token',res.data.token);setToken(res.data.token);setError(null);return true;}catch(err){var _err$response,_err$response$data;console.error('Registration error:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.msg)||'Registration failed');return false;}};// Login user\nconst login=async formData=>{try{const res=await axios.post('http://localhost:5001/api/auth/login',formData);localStorage.setItem('token',res.data.token);setToken(res.data.token);setError(null);return true;}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.msg)||'Login failed');return false;}};// Logout user\nconst logout=()=>{localStorage.removeItem('token');setToken(null);setUser(null);setIsAuthenticated(false);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,token,isAuthenticated,loading,error,register,login,logout},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","axios","jwt_decode","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","token","setToken","localStorage","getItem","isAuthenticated","setIsAuthenticated","loading","setLoading","error","setError","defaults","headers","common","loadUser","res","get","data","err","removeItem","register","formData","console","log","post","setItem","_err$response","_err$response$data","response","msg","login","_err$response2","_err$response2$data","logout","Provider","value"],"sources":["C:/Users/myPC/CascadeProjects/TP-Developpement-AWM-C/TP-Developpement-AWM/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport jwt_decode from 'jwt-decode';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [token, setToken] = useState(localStorage.getItem('token'));\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Set axios default headers\r\n  if (token) {\r\n    axios.defaults.headers.common['x-auth-token'] = token;\r\n  } else {\r\n    delete axios.defaults.headers.common['x-auth-token'];\r\n  }\r\n\r\n  // Load user if token exists\r\n  useEffect(() => {\r\n    const loadUser = async () => {\r\n      if (token) {\r\n        try {\r\n          const res = await axios.get('http://localhost:5001/api/auth/me');\r\n          setUser(res.data);\r\n          setIsAuthenticated(true);\r\n        } catch (err) {\r\n          localStorage.removeItem('token');\r\n          setToken(null);\r\n          setUser(null);\r\n          setIsAuthenticated(false);\r\n          setError('Authentication error. Please login again.');\r\n        }\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    loadUser();\r\n  }, [token]);\r\n\r\n  // Register user\r\n  const register = async (formData) => {\r\n    try {\r\n      console.log('Sending registration request with data:', formData);\r\n      const res = await axios.post('http://localhost:5001/api/auth/register', formData);\r\n      console.log('Registration response:', res.data);\r\n      localStorage.setItem('token', res.data.token);\r\n      setToken(res.data.token);\r\n      setError(null);\r\n      return true;\r\n    } catch (err) {\r\n      console.error('Registration error:', err);\r\n      setError(err.response?.data?.msg || 'Registration failed');\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Login user\r\n  const login = async (formData) => {\r\n    try {\r\n      const res = await axios.post('http://localhost:5001/api/auth/login', formData);\r\n      localStorage.setItem('token', res.data.token);\r\n      setToken(res.data.token);\r\n      setError(null);\r\n      return true;\r\n    } catch (err) {\r\n      setError(err.response?.data?.msg || 'Login failed');\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Logout user\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    setToken(null);\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        token,\r\n        isAuthenticated,\r\n        loading,\r\n        error,\r\n        register,\r\n        login,\r\n        logout\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}